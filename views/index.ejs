
<%- include("partial/header") -%>

      <div class="navbar-expand-md">
        <div class="collapse navbar-collapse" id="navbar-menu">
          <div class="navbar navbar-light">
            <div class="container-xl">
              <ul class="navbar-nav">
                <li class="nav-item active">
                  <a class="nav-link" href="./" >
                    <span class="nav-link-icon d-md-none d-lg-inline-block"><!-- Download SVG icon from http://tabler-icons.io/i/home -->
                      <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><polyline points="5 12 3 12 12 3 21 12 19 12" /><path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" /><path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" /></svg>
                    </span>
                    <span class="nav-link-title">
                      Dashboard
                    </span>
                  </a>
                </li>
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" href="#navbar-help" data-bs-toggle="dropdown" data-bs-auto-close="outside" role="button" aria-expanded="false" >
                    <span class="nav-link-icon d-md-none d-lg-inline-block"><!-- Download SVG icon from http://tabler-icons.io/i/lifebuoy -->
                      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-presentation-analytics" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                          <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                          <path d="M9 12v-4"></path>
                          <path d="M15 12v-2"></path>
                          <path d="M12 12v-1"></path>
                          <path d="M3 4h18"></path>
                          <path d="M4 4v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-10"></path>
                          <path d="M12 16v4"></path>
                          <path d="M9 20h6"></path>
                      </svg>
                      
                  </span>
                    <span class="nav-link-title">
                      Accounts
                    </span>
                  </a>
                  <div class="dropdown-menu">
                    <a class="dropdown-item" href="/bank-accounts">
                    Bank
                    </a>
                    <a class="dropdown-item" href="/supplier-accounts">
                      Suppliers
                      </a>
                    <!-- <a class="dropdown-item" href="/journal-accounts">
                      Journal
                    </a> -->
                  </div>
                </li>
              
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" href="#navbar-help" data-bs-toggle="dropdown" data-bs-auto-close="outside" role="button" aria-expanded="false" >
                    <span class="nav-link-icon d-md-none d-lg-inline-block"><!-- Download SVG icon from http://tabler-icons.io/i/lifebuoy -->
                      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-settings" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                        <path d="M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543 -.826 3.31 -2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756 -2.924 1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065z"></path>
                        <circle cx="12" cy="12" r="3"></circle>
                    </svg>  
                      
                  </span>
                    <span class="nav-link-title">
                      Settings
                    </span>
                  </a>
                  <div class="dropdown-menu">
                    <a class="dropdown-item" href="/users">
                   User Management
                    </a>
                    <a class="dropdown-item" href="/master">
                      Master
                     </a>
                     <a class="dropdown-item" href="/system-settings">
                     System Settings
                     </a>
                  </div>
                </li>
                
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>

      <div class="page-wrapper">
        <div class="container-xl">
          <!-- Page title -->
          <div class="page-header d-print-none">
            <div class="row g-2 align-items-center">
              <div class="col">
                <!-- Page pre-title -->
                <div class="page-pretitle">
                  Overview
                </div>
                <h2 class="page-title">
                  Dashboard
                </h2>
              </div>
              <!-- Page title actions -->
           
            </div>
          </div>
        </div>
        <div class="page-body">
          <div class="container-xl">
            <div class="row row-deck row-cards">


              <div class="col-md-8">
                <div class="card">
                  <div class="card-body">
                    <div class="d-flex">
                      <h3 class="card-title">Expenses</h3>
                      <div class="ms-auto">
                        <h4 class="text-muted">Current Year - 2022</h4>
                      </div>
                    </div>
                    <div id="chart-tasks-overview"></div>
                  </div>
                </div>
              </div>

              <div class="col-md-6 col-lg-4">
                <div class="card">
                  <div class="card-header">
                      <h3>Cost Centers Expenses - 2022</h3>
                  </div>
                  <div class="table-responsive"  style="max-height: 15rem">
                  <table class="table card-table table-vcenter">
                    <thead>
                      <tr>
                        <th>Cost Center</th>
                        <th class="text-end">Total</th>
                        <!-- <th class="text-end"> <%-  new Date().toLocaleDateString("en-US", { month: 'long' }) %></th> -->
                      </tr>
                    </thead>
                    <tbody>
                      <%foundcC.forEach(function(cc){%>
                        <% if(cc.subTotal>0){%>
                      <tr>
                        <td><%=cc.cost_center%></td>
                        <td class="text-end text-muted fs-5 text-nowrap">
                          QAR
                           <div class="text-warning d-md-inline-flex fs-3 ms-1"><%=(cc.subTotal).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,') %></div>
                         </td>
                      </tr>
                      <%}%>
                      <%})%>
                    </tbody>
                  </table>
                </div>
                </div>
              </div>

              <div class="col-md-12 col-lg-12">
                <div class="card">
                  <div class="card-header hd-right">
                    <div class="row row-cards">
                      <div class="col-sm-6 col-lg-3">
                        <div class="card card-sm">
                          <div class="card-status-top bg-yellow"></div>
                          
                          <div class="card-body">
                            <div class="row align-items-center">
                            
                              <div class="col">
                                
                                <div class="fw-bold fs-1">
                                  <%=  voucherItems.length %>
                                </div>
                                <div class="text-muted">
                                  Total Transactions
                                </div>
                              </div>
                              <div class="col-auto">
                                <span class="bg-orange-lt avatar fs-2 ">
                                  <i class="ti ti-list-numbers"></i>
                                 </span>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
               
                      <div class="col-sm-6 col-lg-3">
                        <div class="card card-sm">
                          <!-- <div class="card-status-start bg-blue"></div> -->
                          <div class="card-body">
                           
                            <div class="row align-items-center">
                          
                              <div class="col">
                                <div class="fw-bold fs-1">
                                  <span class="text-muted fs-5 fw-normal">QAR</span>
                                  <%  var sumOfCC = 0 %>
                                  <%  voucherItems.forEach(function(item){ %>
                                    <%  if(item.payment_mode !="Bank Transfer"){ %>
                                    <%  sumOfCC += + item.total_payment %>
                                    <% } %>
                                    <%  }) %>
                                  
                                    <%= (sumOfCC).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,') %>
                                 
                                </div>
                                <div class="text-muted">
                                  Total Cash and Cheque
                                </div>
                              </div>
                              <div class="col-auto">
                                <span class="bg-green-lt avatar fs-2 ">
                                  <i class="ti ti-cash-banknote"></i>
                                 </span>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-sm-6 col-lg-3">
                        <div class="card card-sm">
                          <div class="card-body">
                            <!-- <div class="card-status-top bg-blue"></div> -->
                            <div class="row align-items-center">
                          
                              <div class="col">
                               
                                <div class="fw-bold fs-1">
                                  <span class="text-muted fs-5 fw-normal">QAR</span>
                                  <%  var sumOfBT = 0 %>
                                  <%  voucherItems.forEach(function(item){ %>
                                    <%  if(item.payment_mode ==="Bank Transfer"){ %>
                                    <%  sumOfBT += + item.total_payment %>
                                    <% } %>
                                    <%  }) %>
                                  
                                    <%= (sumOfBT).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,') %>
                              
                                </div>
                                <div class="text-muted">
                                  Total Bank Transfer
                                </div>
                              </div>
                              <div class="col-auto">
                                <span class="bg-green-lt avatar fs-2 ">
                                  <i class="ti ti-cash-banknote"></i>
                                 </span>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-sm-6 col-lg-3">
                        <div class="card card-sm">
                          <div class="card-status-top bg-green"></div>
                          <div class="card-body">
                            <div class="row align-items-center">
                           
                              <div class="col">
                               
                                <div class="fw-bold fs-1">
                                  <span class="text-muted fs-5 fw-normal">QAR</span>
                                  <%  var sumOfTotal = 0 %>
                                  <%  voucherItems.forEach(function(item){ %>
                                    <%  sumOfTotal += + item.total_payment %>
                                    <%  }) %>
                                    <%=  (sumOfTotal).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,') %>
                                    
                                </div>
                                <div class="text-muted">
                                  Total Withdrawal
                                </div>
                              </div>
                              <div class="col-auto">
                                <span class="bg-green-lt avatar fs-2 ">
                                  <i class="ti ti-cash"></i>
                                 </span>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                    </div>
                  </div>

                  <div class="card-body border-bottom py-3">
                    <div class="d-flex">
                      <h3>Transactions</h3>
                      <div class="ms-auto text-muted">
                        <div class="input-icon">
                          <span class="input-icon-addon">
                            <i class="ti ti-search"></i>
                          </span>
                          <input type="text" id="searchPV"  class="form-control" placeholder="Search here…" aria-label="Search">
                        </div>   
                      </div>
                    </div>
                  </div>
                  <div class="card-table table-responsive">

                    <div class="table-responsive"  style="max-height: 30rem">
                      <table class="table card-table table-vcenter text-nowrap datatable">
                        <thead>
                          <tr>
                            <th>Transaction  No</th> 
                            <th> Date</th>
                            <th>Payment From</th>
                            <th>Payment Mode</th>
                            <th>Description</th>
                            <th>Amount</th>
                            <th>Created By</th>
                            <th>Status</th>
                           
                          </tr>
                        </thead>
                        <tbody id="payVoucher" >
                          <%  voucherItems.forEach(function(item){ %>
                          <tr>
                            <td>
                              <form action="/view-voucher" method="post">
                                <button action="submit" value="<%=item.payment_voucher_no%>" name="pavNO" class="btn btn-outline-secondary w-70 btn-sm " data-bs-toggle="tooltip" data-bs-placement="right" data-bs-custom-class="custom-tooltip" data-bs-title="Print Payment Voucher">
                                  <%=item.payment_voucher_no%>
                                </button>
                              </form>
                           
                            </td>
                            <td >
                             
                                <%=(new Date(item.date).toLocaleDateString("en-US", {year: 'numeric', day: 'numeric', month: 'short' })) %>
                            </td>
                            <td>
                             
                              <%=item.payment_from%>
                           
                            </td>
                            <td>
                              <% if(item.payment_mode ==="Bank Transfer"){%>
                                <form action="/print-bank-voucher" method="post">
                                  <%=item.payment_mode%>
                                  <button action="submit" value="<%=item.payment_voucher_no%>" name="pavNO" class="btn btn-ghost-dark w-1 btn--small" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-custom-class="custom-tooltip" data-bs-title="Print Bank Letter">
                                    <i class="ti ti-clipboard-text"></i>
                                  </button>
                                  </form>

                              <%}else{ %>
                                <%=item.payment_mode%>
                                <% } %>
                            </td>
                            <td class="text-capitalize">
                              <%=item.description%>
                            </td>
     
                            <td class="text-nowrap text-muted fs-5">
                             QAR
                              <div class="text-danger d-md-inline-flex fw-bold fs-3 ms-1"> <%= (item.total_payment).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,')%></div>
                             
                            </td>
                            <td>
                              <%=item.created_by%>
                            </td>
                            <td>
                              <span class="status status-red  fs-5">
                                <%= (item.status)%>
                              </span>
                            </td>
                        
  
                          
                          </tr>
                         
                          <%  }) %>
                        </tbody>
                      </table>
                    </div>
                    <div class="card-footer d-flex align-items-center">
           
                    </div>
                 
                  </div>
                </div>
              </div>


           

            </div>
          </div>
        </div>

        <script>
          $(document).ready(function(){
            $("#searchPV").on("keyup", function() {
              var value = $(this).val().toLowerCase();
              $("#payVoucher tr").filter(function() {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
              });
            });
          });
          </script>

          <script>

                 let dataArray = [];
                 let [jan, feb, mar, apr, may, jun, jul, aug, sep, oct, nov, dec] =  Array(12).fill(0); 

            '<%  voucherItems.forEach(function(item){ %>'
             
            var dMonth = new Date('<%=item.date%>').getMonth() + 1;

            if (dMonth === 1){
             
              jan += + '<%=item.total_payment%>'

            }else if(dMonth === 2){

              feb += + '<%=item.total_payment%>'

            }else if(dMonth === 3){

              mar += + '<%=item.total_payment%>'

            }else if(dMonth === 4){

              apr += + '<%=item.total_payment%>'

            }else if(dMonth === 5){

              may += + '<%=item.total_payment%>'

            }else if(dMonth === 6){

              jun += + '<%=item.total_payment%>'

            }else if(dMonth === 7){

              jul += + '<%=item.total_payment%>'

            }else if(dMonth === 8){

              aug += + '<%=item.total_payment%>'

            }else if(dMonth === 9){

              sep += + '<%=item.total_payment%>'

            }else if(dMonth === 10){

              oct += + '<%=item.total_payment%>'

            }else if(dMonth === 11){

              nov += + '<%=item.total_payment%>'

            }else if(dMonth === 12){

              dec += + '<%=item.total_payment%>'

            }
            
            ' <%  }) %>'
                
                  dataArray[0] = jan;
                  dataArray[1] = feb;
                  dataArray[2] = mar;
                  dataArray[3] = apr;
                  dataArray[4] = may;
                  dataArray[5] = jun;
                  dataArray[6] = jul;
                  dataArray[7] = aug;
                  dataArray[8] = sep;
                  dataArray[9] = oct;
                  dataArray[10] = nov;
                  dataArray[11] = dec;


           // @formatter:off
           document.addEventListener("DOMContentLoaded", function () {
               window.ApexCharts && (new ApexCharts(document.getElementById('chart-tasks-overview'), {
                   chart: {
                       type: "line",
                       fontFamily: 'inherit',
                       height: 240,
                       parentHeightOffset: 0,
                       toolbar: {
                           show: false,
                       },
                       animations: {
                           enabled: true
                       },
                       
                   },
                   plotOptions: {
                       bar: {
                           columnWidth: '50%',
                       }
                   },
                   dataLabels: {
                       enabled: false,
                   },
                   fill: {
                       opacity: 1,
                   },
                   stroke: {
                   width: 2,
                   lineCap: "round",
                   curve: "smooth",
                 },
                   series: [{
                       name: "Expenses",
                      
                       data: dataArray
                   }],
                   grid: {
                       padding: {
                           top: -20,
                           right: 0,
                           left: -4,
                           bottom: -4
                       },
                       strokeDashArray: 4,
                   },
                   xaxis: {
                       labels: {
                           padding: 0,
                       },
                       tooltip: {
                           enabled: false
                       },
                       axisBorder: {
                           show: false,
                       },
                     
                     
                       categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                   },
                   yaxis: {
                       labels: {
                                   formatter: function(number) {
                                       var SI_SYMBOL = ["", "k", "M", "G", "T", "P", "E"];
                                 // what tier? (determines SI symbol)
                                   var tier = Math.log10(Math.abs(number)) / 3 | 0;
       
                               // if zero, we don't need a suffix
                               if(tier == 0) return number;
       
                               // get suffix and determine scale
                               var suffix = SI_SYMBOL[tier];
                               var scale = Math.pow(10, tier * 3);
       
                               // scale the number
                               var scaled = number / scale;
       
                               // format number and add suffix
                               return 'QAR ' + scaled.toFixed(1) + suffix;
                                   }
                               },
                   },
                   colors: ["#f59f00"],
                   legend: {
                       show: false,
                   },
               })).render();
           });
           // @formatter:on
         </script>
          
        <%- include("partial/footer") -%>